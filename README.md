REST API demo project written in Python

# Public Access

Server is publicly hosted

## Webpage URL

https://larssaalbrink.dk/ui/

## API Docs URL

https://larssaalbrink.dk/docs/

# Design Decisions

## Tech Stack

### Backend (Python)

- SQLModel (SQLAlchemy + Pydantic)
- FastAPI
- SQLite
- uvicorn

### Frontend (Typescript)

- React
- Vite

### Deployment

- Docker
- Nginx
- Google Cloud Platform (GCP)

## Considerations

- Added a web-frontend and deployed solution to a production environment in addition to the set requirements.
- FastAPI docs page is enabled. Usually docs are not exposed in production, but as it is explicitly stated as a deliverable by requirements, docs are never disabled for this project.
- uvicorn server for hot-reloading and great async support.
- Nginx used for proxying requests to the FastAPI server. This makes https connections & DDOS mitigation easy, improving security.
- Efforts have been made to prevent information leakage in ways JWT alone does not prevent. (ID obfuscation)
- Server datatypes and database schema are tightly coupled by a single source of truth. This is fine for this usecase which does not require interoperability between multiple DB schemas.
- Production deployed of the project is done as a Docker image running in a single VM on GCP. Choice dictated by desire to keep costs for cloud compute + persistent database as low as possible.
Sqlite was chosen with same reasoning, Postgres would have been slightly more expensive.
- Vite bundler is used to produce a single-file bundle for the frontend. This makes hosting the webpage using nginx very simple.
# Development

## Requirements

The following must be installed on your system for development:
- Docker
- NodeJS + npm
- curl

A python3 virtual environment with the dependencies listed in pyproject.toml is recommended for syntax-highlighting.

## Docs

API documentation is available at http://127.0.0.1:8000/docs when running the app locally.

## Tests

### Build docker image for Tests

docker build -t py_rest_demo_test -f Dockerfile.test .

### Run docker image for Tests

docker run --rm py_rest_demo_test

## Run app

### Build docker image for dev

docker build -t py_rest_demo -f Dockerfile.dev .

### Run docker image for dev

docker run --rm -p 8000:8000 -v $(pwd)/app:/app -e SECRET_KEY=gouda_kaas py_rest_demo

### Run frontend dev server

cd ui
npm run dev

## Dev curl commands

### Create user

curl -i -X POST http://127.0.0.1:8000/register \
  -H "Content-Type: application/json" \
  -d '{

    "username": "larssaalbrink@gmail.com",
    "password": "kaaskop"

  }'

### Get token (and store it in TOKEN env var)

export TOKEN=$(curl -s -X POST "http://127.0.0.1:8000/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=larssaalbrink@gmail.com" \
  -d "password=kaaskop" | jq -r '.access_token')

### Create task (Requires token)

curl -i -X POST "http://127.0.0.1:8000/tasks" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{

    "title": "Eat cheese",
    "description": "Eat all cheese currently in the fridge",
    "due_date": "2025-02-21"

  }'

### Get tasks (Requires token)

curl http://127.0.0.1:8000/tasks \
  -H "Authorization: Bearer $TOKEN"

### Update task (Requires token)

curl -i -X PUT "http://127.0.0.1:8000/tasks/52066650752017374089771338888820989312" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{

    "title": "Drink milk",
    "description": "Drink absurd amount of milk",
    "due_date": "2025-03-01"

  }'

### Delete task (Requires token)

curl -i -X DELETE "http://127.0.0.1:8000/tasks/52066650752017374089771338888820989312" \
  -H "Authorization: Bearer $TOKEN"

# Production

Server currently hosted on Google Cloud Platform, accessible at https://larssaalbrink.dk

## CI/CD

### Certs

Current certs are valid until 2025-05-01.
This demo does not auto-refresh certs, as server will be decommissioned before this date.
New certs can manually be generated by running
sudo certbot --nginx -d larssaalbrink.dk -d www.larssaalbrink.dk
on the server.

### Start production docker image

docker run -p 80:80 -p 443:443 -e SECRET_KEY=<A_GREAT_SECRET> -d <DOCKER_IMAGE_ID>

## Production curl commands

### Create user

curl -i -X POST https://larssaalbrink.dk/register \
  -H "Content-Type: application/json" \
  -d '{

    "username": "larssaalbrink@gmail.com",
    "password": "kaaskop"

  }'

### Get token (and store it in TOKEN env var)

export TOKEN=$(curl -s -X POST "https://larssaalbrink.dk/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=larssaalbrink@gmail.com" \
  -d "password=kaaskop" | jq -r '.access_token')

### Create task (Requires token)

curl -i -X POST "https://larssaalbrink.dk/tasks" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{

    "title": "Eat cheese",
    "description": "Eat all cheese currently in the fridge",
    "due_date": "2025-02-21"

  }'

### Get tasks (Requires token)

curl https://larssaalbrink.dk/tasks \
  -H "Authorization: Bearer $TOKEN"

### Update task (Requires token)

curl -i -X PUT "https://larssaalbrink.dk/tasks/52066650752017374089771338888820989312" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{

    "title": "Drink milk",
    "description": "Drink absurd amount of milk",
    "due_date": "2025-03-01"

  }'

### Delete task (Requires token)

curl -i -X DELETE "https://larssaalbrink.dk/tasks/52066650752017374089771338888820989312" \
  -H "Authorization: Bearer $TOKEN"
